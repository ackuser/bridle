/*! bridle 22-07-2013 */
!function(){var a=window.Bridle||{};a.LegendBox=function(){function a(a){a.each(function(a){f=b(a),200>f&&(f=200),c=a.length;var h=d3.select(this).selectAll("svg").data([a]),m=h.enter().append("svg").attr("class","bridle").append("g");m.append("g").attr("class","legend"),h.attr("width",f).attr("height",e);var n=h.select("g").attr("transform","translate("+d.left+","+d.top+")"),o=n.select(".legend").selectAll(".legendItem").data(function(a){return a}),p=o.enter().append("g").attr("class","legendItem").on("click",function(a,b){l.legendClick(a,b),o.classed("disabled",function(a){return a.disabled})}).on("mouseover",function(a,b){l.legendMouseover(a,b)}).on("mouseout",function(a,b){l.legendMouseout(a,b)});p.append("circle").attr("class","circle").attr("cx",0).attr("cy",function(){return"-0.25em"}).attr("r","0.4em").attr("stroke-width",1).attr("stroke",function(a,b){return g(b)}).attr("fill",function(a,b){return g(b)}),p.append("text").attr("class","text").attr("x",j).text(function(a){return k(a)}),o.classed("disabled",function(a){return a.disabled}),o.exit().remove();var q=5,r=0,s=5,t=0;o.attr("opacity",0).attr("transform",function(){var a=d3.select(this).select("text").node().getComputedTextLength()+28;return a>t&&(t=a),q+=r,q>e-d.top-d.bottom&&(q=5,s+=t),r=20,"translate("+s+","+q+")"}).transition().duration(i).attr("opacity",1)})}function b(a){var b=0,c="";a.forEach(function(a){k(a).length>b&&(b=k(a).length,c=k(a))});var d=12*b;return d}var c,d={top:5,bottom:5,left:5,right:5},e=200,f=200,g=d3.scale.category10(),h="Chart Title",i=1e3,j="1em",k=function(a){return a.name},l=d3.dispatch("legendClick","legendMouseover","legendMouseout");return a.dispatch=l,a.margin=function(b){return arguments.length?(d=b,a):d},a.width=function(b){return arguments.length?(f=b,a):f},a.height=function(b){return arguments.length?(e=b,a):e},a.value=function(b){return arguments.length?(value=b,a):value},a.label=function(b){return arguments.length?(label=b,a):label},a.title=function(b){return arguments.length?(h=b,a):h},a.duration=function(b){return arguments.length?(i=b,a):i},a.colors=function(b){return arguments.length?(g=b,a):g},a.nameAccessor=function(b){return arguments.length?(k=b,a):k},a.numData=function(b){return arguments.length?(c=b,a):c},a},a.tooltip={show:function(a,b,c,d){var e=$('<div class="bridle tooltip">');c=c||"s",d=d||20,e.html(b).css({left:-1e3,top:-1e3,opacity:0}).appendTo("body");var f,g,h=e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")),i=e.width()+parseInt(e.css("padding-left"))+parseInt(e.css("padding-right")),j=$(window).width(),k=$(window).height(),l=$("body").scrollTop();switch(c){case"e":case"w":case"n":f=a[0]-i/2,g=a[1]+d,0>f&&(f=5),f+i>j&&(f=j-i-5),g+h>l+k&&(g=a[1]-h-d);break;case"s":f=a[0]-i/2,g=a[1]-h-d,0>f&&(f=5),f+i>j&&(f=j-i-5),l>g&&(g=a[1]+d)}e.css({left:f,top:g,opacity:1})},cleanup:function(){var a=$(".bridle.tooltip");a.css({"transition-delay":"0 !important","-moz-transition-delay":"0 !important","-webkit-transition-delay":"0 !important"}),a.css("opacity",0),setTimeout(function(){a.remove()},500)}},a.BarChart=function(){function b(a){return new Date(a)}function c(b){b.each(function(y){function z(){console.log("mode change"),"grouped"===this.value?(d="grouped",m.domain([0,F]),A()):(d="stacked",m.domain([0,G]),B())}function A(){O.select(".y.axis").transition().duration(r).attr("transform","translate(-25,0)").call(o),O.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("x",function(a,b,c){return t(h(a))+t.rangeBand()/H*c}).attr("width",t.rangeBand()/H).transition().attr("y",function(a){return m(a.y)}).attr("height",function(a){return f-m(a.y)-e.top-e.bottom})}function B(){O.select(".y.axis").transition().duration(r).attr("transform","translate(-25,0)").call(o),O.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("y",function(a){return m(a.y0+a.y)}).attr("height",function(a){return m(a.y0)-m(a.y0+a.y)}).transition().attr("x",function(a){return t(h(a))}).attr("width",t.rangeBand())}var C=this,D=y.filter(function(a){return!a.disabled});D.forEach(function(a){a.values.sort(w)}),D=d3.layout.stack().offset(k).order(l).values(function(a){return a.values}).x(h).y(i)(D),t.domain(D[0].values.map(function(a){return h(a)})).rangeRoundBands([0,g-e.left-e.right],.1);var E=function(){var a=0;return D.forEach(function(b){a+=b.values.length}),a/D.length};u.tickFormat(v).tickValues(t.domain().filter(function(a,b){var c=Math.ceil(200/(g/E()));return!(b%c)}));var F=d3.max(D,function(a){return d3.max(a.values,function(a){return a.y})}),G=d3.max(D,function(a){return d3.max(a.values,function(a){return a.y0+a.y})}),H=D.length;d3.max(D,function(a){return a.values.length}),m.range([f-e.top-e.bottom,0]),"stacked"===d?m.domain([0,G]):m.domain([0,F]);var I=function(a,b,c){return"stacked"===d?t(h(a)):t(h(a))+t.rangeBand()/H*c},J=function(a){return"stacked"===d?m(a.y0+a.y):m(a.y)},K=function(a){return"stacked"===d?m(a.y0)-m(a.y0+a.y):f-m(a.y)-e.top-e.bottom},L=function(){return"stacked"===d?t.rangeBand():t.rangeBand()/H},M=d3.select(C).selectAll("svg").data([D]),N=M.enter().append("svg").attr("class","bridle").append("g");N.append("g").attr("class","rects"),N.append("g").attr("class","x axis"),N.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),N.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(g-e.left-e.right+20)/2+","+-e.top+")"),N.append("g").attr("class","legend").attr("transform","translate("+(g-e.left-e.right+20)+","+0+")").style("font-size","12px"),M.attr("width",g).attr("height",f);var O=M.select("g").attr("transform","translate("+e.left+","+e.top+")"),P=O.select(".rects").selectAll("g.layerrects").data(function(a){return a},function(a){return j(a)}).classed("hover",function(a){return a.hover});P.exit().transition().duration(r).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var Q=P.enter(),R=Q.append("g").attr("class","layerrects").attr("fill",function(a){return n(j(a))}).selectAll("g.rect").data(function(a){return a.values.forEach(function(b){b.name=j(a)}),a.values});R.exit().transition().duration(r).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var S=R.enter().append("g").attr("class","rect");S.append("rect").attr("opacity",.1).attr("x",function(a,b,c){return I(a,b,c)}).attr("y",function(){return f-e.top-e.bottom}).attr("width",function(){return L()}).attr("height",0).on("mouseover",function(a,b,c){x.pointMouseover({x:h(a),y:i(a),series:a.name,pos:[t(h(a)),J(a)],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){x.pointMouseout({})}),O.selectAll("g.layerrects").selectAll("g.rect").select("rect").transition().duration(r).attr("opacity",.9).attr("y",function(a){return J(a)}).attr("height",function(a){return K(a)}).attr("width",function(){return L()}).attr("x",function(a,b,c){return I(a,b,c)}),O.select("text.chartTitle").text(p),O.select(".x.axis").attr("transform","translate(0,"+m.range()[0]+")").call(u),O.select(".y.axis").transition().duration(r).attr("transform","translate(-25,0)").call(o),O.select(".y.axis.label").attr("y",-45).attr("x",(-f+e.top+e.bottom)/2).attr("dy",".1em").text(q),d3.selectAll("input").on("change",z),s.numData()!=y.length&&O.select(".legend").datum(D).call(s),s.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,D.filter(function(a){return!a.disabled}).length||D.forEach(function(a){a.disabled=!1}),b.call(c)}),s.dispatch.on("legendMouseover",function(a){a.hover=!0,b.call(c)}),s.dispatch.on("legendMouseout",function(a){a.hover=!1,b.call(c)}),x.on("pointMouseover.tooltip",function(b){var c=$(C).offset(),d=b.pos[0]+c.left+e.left,f=b.pos[1]+c.top+e.top,g=d3.time.format("%Y-%m-%d");formatterY=d3.format(".02f");var h="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+g(b.x)+", "+formatterY(b.y)+"]</span>"+"</p>";a.tooltip.show([d,f],h)}),x.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var d="stacked",e={top:50,bottom:100,left:100,right:100},f=400,g=1e3,h=function(a){return a.x},i=function(a){return a.y},j=function(a){return a.name},k="zero",l="default",m=d3.scale.linear(),n=d3.scale.category10(),o=d3.svg.axis().scale(m).orient("left"),p="Chart Title",q="Axis Title",r=1e3,s=a.LegendBox().nameAccessor(function(a){return j(a)}),t=d3.scale.ordinal(),u=d3.svg.axis().scale(t).tickSize(5).orient("bottom"),v=d3.time.format("%Y-%m-%d"),w=function(a,c){return b(h(a))>b(h(c))?1:-1},x=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout");return c.dispatch=x,c.margin=function(a){return arguments.length?(e=a,c):e},c.width=function(a){return arguments.length?(g=a,c):g},c.height=function(a){return arguments.length?(f=a,c):f},c.value=function(a){return arguments.length?(value=a,c):value},c.label=function(a){return arguments.length?(label=a,c):label},c.title=function(a){return arguments.length?(p=a,c):p},c.xAxis=function(a){return arguments.length?(u=a,c):u},c.yAxis=function(a){return arguments.length?(o=a,c):o},c.yAxisTitle=function(a){return arguments.length?(q=a,c):q},c.duration=function(a){return arguments.length?(r=a,c):r},c.tickFormat=function(a){return arguments.length?(v=a,c):v},c.legend=function(a){return arguments.length?(s=a,c):s},c.xValue=function(a){return arguments.length?(h=a,c):h},c.yValue=function(a){return arguments.length?(i=a,c):i},c.nameValue=function(a){return arguments.length?(j=a,c):j},c.colors=function(a){return arguments.length?(n=a,c):n},c.mode=function(a){return arguments.length?(d=a,c):d},c},a.BarChartCategorical=function(){function b(x){x.each(function(y){function z(){console.log("mode change"),"grouped"===this.value?(c="grouped",l.domain([0,E]),A()):(c="stacked",l.domain([0,F]),B())}function A(){N.select(".y.axis").transition().duration(q).attr("transform","translate(-25,0)").call(n),N.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("x",function(a,b,c){return s(g(a))+s.rangeBand()/G*c}).attr("width",s.rangeBand()/G).transition().attr("y",function(a){return l(a.y)}).attr("height",function(a){return e-l(a.y)-d.top-d.bottom})}function B(){N.select(".y.axis").transition().duration(q).attr("transform","translate(-25,0)").call(n),N.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("y",function(a){return l(a.y0+a.y)}).attr("height",function(a){return l(a.y0)-l(a.y0+a.y)}).transition().attr("x",function(a){return s(g(a))}).attr("width",s.rangeBand())}var C=this,D=y.filter(function(a){return!a.disabled});D=d3.layout.stack().offset(j).order(k).values(function(a){return a.values}).x(g).y(h)(D),s.domain(D[0].values.map(function(a){return console.log(a,g(a),g),g(a)})).rangeRoundBands([0,f-d.left-d.right],.1);var E=d3.max(D,function(a){return d3.max(a.values,function(a){return a.y})}),F=d3.max(D,function(a){return d3.max(a.values,function(a){return a.y0+a.y})}),G=D.length;d3.max(D,function(a){return a.values.length}),l.range([e-d.top-d.bottom,0]),"stacked"===c?l.domain([0,F]):l.domain([0,E]);var H=function(a,b,d){return"stacked"===c?s(g(a)):s(g(a))+s.rangeBand()/G*d},I=function(a){return"stacked"===c?l(a.y0+a.y):l(a.y)},J=function(a){return"stacked"===c?l(a.y0)-l(a.y0+a.y):e-l(a.y)-d.top-d.bottom},K=function(){return"stacked"===c?s.rangeBand():s.rangeBand()/G},L=d3.select(C).selectAll("svg").data([D]),M=L.enter().append("svg").attr("class","bridle").append("g");M.append("g").attr("class","rects"),M.append("g").attr("class","x axis"),M.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),M.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(f-d.left-d.right+20)/2+","+-d.top+")"),M.append("g").attr("class","legend").attr("transform","translate("+(f-d.left-d.right+20)+","+0+")").style("font-size","12px"),L.attr("width",f).attr("height",e);var N=L.select("g").attr("transform","translate("+d.left+","+d.top+")"),O=N.select(".rects").selectAll("g.layerrects").data(function(a){return a},function(a){return i(a)}).classed("hover",function(a){return a.hover});O.exit().transition().duration(q).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var P=O.enter(),Q=P.append("g").attr("class","layerrects").attr("fill",function(a){return m(i(a))}).selectAll("g.rect").data(function(a){return a.values.forEach(function(b){b.name=i(a)}),a.values});Q.exit().transition().duration(q).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var R=Q.enter().append("g").attr("class","rect");R.append("rect").attr("opacity",.1).attr("x",function(a,b,c){return H(a,b,c)}).attr("y",function(){return e-d.top-d.bottom}).attr("width",function(){return K()}).attr("height",0).on("mouseover",function(a,b,c){w.pointMouseover({x:g(a),y:h(a),series:a.name,pos:[s(g(a)),I(a)],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){w.pointMouseout({})}),N.selectAll("g.layerrects").selectAll("g.rect").select("rect").transition().duration(q).attr("opacity",.9).attr("y",function(a){return I(a)}).attr("height",function(a){return J(a)}).attr("width",function(){return K()}).attr("x",function(a,b,c){return H(a,b,c)}),N.select("text.chartTitle").text(o),N.select(".x.axis").attr("transform","translate(0,"+l.range()[0]+")").call(t),N.select(".y.axis").transition().duration(q).attr("transform","translate(-25,0)").call(n),N.select(".y.axis.label").attr("y",-45).attr("x",(-e+d.top+d.bottom)/2).attr("dy",".1em").text(p),d3.selectAll("input").on("change",z),r.numData()!=y.length&&N.select(".legend").datum(D).call(r),r.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,D.filter(function(a){return!a.disabled}).length||D.forEach(function(a){a.disabled=!1}),x.call(b)}),r.dispatch.on("legendMouseover",function(a){a.hover=!0,x.call(b)}),r.dispatch.on("legendMouseout",function(a){a.hover=!1,x.call(b)}),w.on("pointMouseover.tooltip",function(b){var c=$(C).offset(),e=b.pos[0]+c.left+d.left,f=b.pos[1]+c.top+d.top,g="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+u(b.x)+", "+v(b.y)+"]</span>"+"</p>";a.tooltip.show([e,f],g)}),w.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var c="stacked",d={top:50,bottom:100,left:100,right:100},e=400,f=1e3,g=function(a){return a.x},h=function(a){return a.y},i=function(a){return a.name},j="zero",k="default",l=d3.scale.linear(),m=d3.scale.category10(),n=d3.svg.axis().scale(l).orient("left"),o="Chart Title",p="Axis Title",q=1e3,r=a.LegendBox().nameAccessor(function(a){return i(a)}),s=d3.scale.ordinal(),t=d3.svg.axis().scale(s).tickSize(5).orient("bottom"),u=function(a){return a},v=d3.format(".02f"),w=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout");return b.dispatch=w,b.margin=function(a){return arguments.length?(d=a,b):d},b.width=function(a){return arguments.length?(f=a,b):f},b.height=function(a){return arguments.length?(e=a,b):e},b.value=function(a){return arguments.length?(value=a,b):value},b.label=function(a){return arguments.length?(label=a,b):label},b.title=function(a){return arguments.length?(o=a,b):o},b.xAxis=function(a){return arguments.length?(t=a,b):t},b.yAxis=function(a){return arguments.length?(n=a,b):n},b.yAxisTitle=function(a){return arguments.length?(p=a,b):p},b.duration=function(a){return arguments.length?(q=a,b):q},b.legend=function(a){return arguments.length?(r=a,b):r},b.xValue=function(a){return arguments.length?(g=a,b):g},b.yValue=function(a){return arguments.length?(h=a,b):h},b.nameValue=function(a){return arguments.length?(i=a,b):i},b.colors=function(a){return arguments.length?(m=a,b):m},b.mode=function(a){return arguments.length?(c=a,b):c},b},a.LineChart=function(){"use Strict";function b(s){s.each(function(t){var u=this,v=t.filter(function(a){return!a.disabled}),w=v.map(function(a){return d3.max(a.values,function(a){return f(a)})}),x=v.map(function(a){return d3.min(a.values,function(a){return f(a)})});l.domain([d3.min(x),d3.max(w)]).range([0,e-c.left-c.right]),l(f(v[0].values[1]))-l(f(v[0].values[0]));var y=v.map(function(a){return d3.max(a.values,function(a){return g(a)})});m.domain([0,d3.max(y)]).range([d-c.top-c.bottom,0]);var z=d3.svg.line().x(function(a){return l(f(a))}).y(function(a){return m(g(a))}),A=d3.select(this).selectAll("svg").data([v]),B=A.enter().append("svg").attr("class","bridle").append("g");B.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e-c.left-c.right).attr("height",d-c.top-c.bottom),B.append("g").attr("class","x axis"),B.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),B.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(e-c.left-c.right+20)/2+","+-c.top+")"),B.append("g").attr("class","legend").attr("transform","translate("+(e-c.left-c.right+20)+","+0+")").style("font-size","12px"),B.append("g").attr("class","lines"),A.attr("width",e).attr("height",d);var C=A.select("g").attr("transform","translate("+c.left+","+c.top+")");A.select("defs").select("clippath").select("rect").attr("width",e-c.left-c.right).attr("height",d-c.top-c.bottom);var D=A.select(".lines").selectAll("g.series").data(function(a){return a},function(a){return h(a)}).classed("hover",function(a){return a.hover});D.exit().transition().duration(k).style("opacity",0).remove(),D.enter().append("g").attr("class","series").attr("id",function(a){return"series_"+h(a)});var E=D.selectAll("path.line").data(function(a){return[a]});E.enter().append("path").attr("stroke",function(a){return p(h(a))}).attr("class","line").attr("stroke-opacity",0).attr("d",function(a){return z(a.values)});var F=D.selectAll("g.circles").data(function(a){return a.values.forEach(function(b){b.name=h(a)}),[a.values]});F.enter().append("g").attr("class","circles");var G=D.selectAll("circle").data(function(a){return a.values},function(a){return f(a)}),H=G.enter();H.append("circle").attr("opacity",.1).attr("class","seriespoint").attr("r",0).attr("cx",function(a){return l(f(a))}).attr("cy",function(a){return m(g(a))}).on("mouseover",function(a,b,c){r.pointMouseover({x:f(a),y:g(a),series:a.name,pos:[l(f(a)),m(g(a))],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){r.pointMouseout({})}),G.exit().attr("fill-opacity",0).attr("r",0).remove(),D.selectAll("path.line").attr("stroke",function(a){return p(h(a))}).attr("fill","none").attr("d",function(a){return z(a.values)}).attr("clip-path","url(#clip)").transition().duration(k).ease("linear").attr("stroke-opacity",1).attr("stroke-width",1.5),D.selectAll("circle.seriespoint").transition().duration(k).ease("linear").attr("r",5).attr("cx",function(a){return l(f(a))}).attr("cy",function(a){return m(g(a))}),C.select("text.chartTitle").text(i),C.select(".x.axis").attr("transform","translate(0,"+m.range()[0]+")").transition().duration(k).ease("linear").call(n),C.select(".y.axis").transition().duration(k).attr("transform","translate(-25,0)").call(o),C.select(".y.axis.label").attr("y",-45).attr("x",(-d+c.top+c.bottom)/2).attr("dy",".1em").text(j),q.numData()!=t.length&&C.select(".legend").datum(v).call(q),q.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,v.filter(function(a){return!a.disabled}).length||v.forEach(function(a){a.disabled=!1}),s.call(b)}),q.dispatch.on("legendMouseover",function(a){a.hover=!0,s.call(b)}),q.dispatch.on("legendMouseout",function(a){a.hover=!1,s.call(b)}),r.on("pointMouseover.tooltip",function(b){var d=$(u).offset(),e=b.pos[0]+d.left+c.left,f=b.pos[1]+d.top+c.top,g=d3.time.format("%Y-%m-%d");formatterY=d3.format(".02f");var h="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+g(b.x)+", "+formatterY(b.y)+"]</span>"+"</p>";a.tooltip.show([e,f],h)}),r.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var c={top:50,bottom:30,left:100,right:100},d=400,e=1e3,f=function(a){return a.x},g=function(a){return a.y},h=function(a){return a.name},i="Chart Title",j="Axis Title",k=1e3,l=d3.time.scale.utc(),m=d3.scale.linear().nice(),n=d3.svg.axis().scale(l).orient("bottom");n.tickSize(-d+c.top+c.bottom,0),n.tickSubdivide(!0);var o=d3.svg.axis().scale(m).orient("left"),p=d3.scale.category10(),q=a.LegendBox().nameAccessor(function(a){return h(a)}),r=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout");return b.dispatch=r,b.margin=function(a){return arguments.length?(c=a,b):c},b.width=function(a){return arguments.length?(e=a,b):e},b.height=function(a){return arguments.length?(d=a,b):d},b.value=function(a){return arguments.length?(value=a,b):value},b.label=function(a){return arguments.length?(label=a,b):label},b.title=function(a){return arguments.length?(i=a,b):i},b.xAxis=function(a){return arguments.length?(n=a,b):n},b.yAxis=function(a){return arguments.length?(o=a,b):o},b.yAxisTitle=function(a){return arguments.length?(j=a,b):j},b.duration=function(a){return arguments.length?(k=a,b):k},b.legend=function(a){return arguments.length?(q=a,b):q},b.xValue=function(a){return arguments.length?(f=a,b):f},b.yValue=function(a){return arguments.length?(g=a,b):g},b.nameValue=function(a){return arguments.length?(h=a,b):h},b.colors=function(a){return arguments.length?(p=a,b):p},b},a.StackedChart=function(){function b(a){return o(i(a))}function c(a){return p(a.y0)}function d(a){return p(a.y0+a.y)}function e(c){c.each(function(n){var z=this;data=n.filter(function(a){return!a.disabled}),data=d3.layout.stack().offset(l).order(m).values(function(a){return a.values}).x(i).y(j)(data),o.range([0,h-f.left-f.right]);var A=data.map(function(a){return d3.max(a.values,function(a){return i(a)})}),B=data.map(function(a){return d3.min(a.values,function(a){return i(a)})});o.domain([d3.min(B),d3.max(A)]),p.range([g-f.top-f.bottom,0]);var C=data.map(function(a){return d3.max(a.values,function(a){return a.y+a.y0})});p.domain([0,d3.max(C)]);var D=d3.select(this).selectAll("svg").data([data]),E=D.enter().append("svg").attr("class","bridle").append("g");E.append("g").attr("class","x axis"),E.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),E.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(h-f.left-f.right+20)/2+","+-f.top+")"),E.append("g").attr("class","legend").attr("transform","translate("+(h-f.left-f.right+20)+","+0+")").style("font-size","12px"),E.append("g").attr("class","areas"),D.attr("width",h).attr("height",g);var F=D.select("g").attr("transform","translate("+f.left+","+f.top+")"),G=F.select(".areas").selectAll("g.area").data(function(a){return a},function(a){return k(a)}).classed("hover",function(a){return a.hover}),H=G.enter().insert("g").attr("class","area");H.append("path").attr("class","area").attr("fill",function(a){return q(k(a))}).attr("fill-opacity",0).attr("d",function(a){return t(a.values)});var I=H.append("g").attr("class","seriespoints").selectAll("circle").data(function(a){return a.values.forEach(function(b){b.name=k(a)}),a.values});I.enter().append("circle").attr("fill-opacity",.1).attr("class","seriespoint").attr("r",0).attr("cx",function(a){return b(a)}).attr("cy",function(a){return d(a)}).on("mouseover",function(a,b,c){y.pointMouseover({x:i(a),y:j(a),series:a.name,pos:[o(i(a)),p(a.y0+a.y)],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){y.pointMouseout({})});var J=G.exit().transition().duration(w).style("opacity",0).remove();I.exit().attr("fill-opacity",0).attr("r",0).remove(),J.selectAll("path").attr("stroke-opacity",0).attr("fill-opacity",0).remove(),F.selectAll("path.area").attr("fill",function(a){return q(k(a))}).transition().duration(w).attr("fill-opacity",.8).attr("d",function(a){return t(a.values)}),F.selectAll("circle.seriespoint").transition().duration(w).attr("r",5).attr("cx",function(a){return b(a)}).attr("cy",function(a){return d(a)}),F.select("text.chartTitle").text(u),F.select(".x.axis").attr("transform","translate(0,"+p.range()[0]+")").call(r),F.select(".y.axis").transition().duration(w).attr("transform","translate(-25,0)").call(s),F.select(".y.axis.label").attr("y",-45).attr("x",(-g+f.top+f.bottom)/2).attr("dy",".1em").text(v),x.numData()!=n.length&&F.select(".legend").datum(data).call(x),x.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,data.filter(function(a){return!a.disabled}).length||data.forEach(function(a){a.disabled=!1}),c.call(e)}),x.dispatch.on("legendMouseover",function(a){a.hover=!0,c.call(e)}),x.dispatch.on("legendMouseout",function(a){a.hover=!1,c.call(e)}),y.on("pointMouseover.tooltip",function(b){var c=$(z).offset(),d=b.pos[0]+c.left+f.left,e=b.pos[1]+c.top+f.top,g=d3.time.format("%Y-%m-%d");formatterY=d3.format(".02f");var h="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+g(b.x)+", "+formatterY(b.y)+"]</span>"+"</p>";a.tooltip.show([d,e],h)}),y.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var f={top:50,bottom:30,left:100,right:100},g=400,h=1e3,i=function(a){return a.x},j=function(a){return a.y},k=function(a){return a.name},l="zero",m="default",n="linear",o=d3.time.scale.utc(),p=d3.scale.linear().nice(),q=d3.scale.category10(),r=d3.svg.axis().scale(o).orient("bottom"),s=d3.svg.axis().scale(p).orient("left");r.tickSize(-g+f.top+f.bottom,0),r.tickSubdivide(!0);var t=d3.svg.area().interpolate(n).x(b).y0(c).y1(d),u="Chart Title",v="Axis Title",w=1e3,x=a.LegendBox().nameAccessor(function(a){return k(a)}),y=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout");return e.dispatch=y,e.margin=function(a){return arguments.length?(f=a,e):f},e.width=function(a){return arguments.length?(h=a,e):h},e.height=function(a){return arguments.length?(g=a,e):g},e.value=function(a){return arguments.length?(value=a,e):value},e.label=function(a){return arguments.length?(label=a,e):label},e.title=function(a){return arguments.length?(u=a,e):u},e.xAxis=function(a){return arguments.length?(r=a,e):r},e.yAxis=function(a){return arguments.length?(s=a,e):s},e.yAxisTitle=function(a){return arguments.length?(v=a,e):v},e.duration=function(a){return arguments.length?(w=a,e):w},e.legend=function(a){return arguments.length?(x=a,e):x},e.xValue=function(a){return arguments.length?(i=a,e):i},e.yValue=function(a){return arguments.length?(j=a,e):j},e.nameValue=function(a){return arguments.length?(k=a,e):k},e.colors=function(a){return arguments.length?(q=a,e):q},e},a.Table=function(){function a(c){c.each(function(c){function l(a){return c.headers.indexOf(a)}var m=this;("undefined"==typeof f||f.rows.length!=c.rows.length)&&(f=$.extend(!0,{},c)),1==k&&""==i&&(k=!1,c=f),""!=i&&(c.rows=b(c.rows,function(a,b){return d(a[l(i)],b[l(i)])}));var n=d3.select(m).selectAll("table").data([c]),o=n.enter().append("table").attr("class","table table-hover bridle").attr("style","margin-top: "+h.top+"px; margin-bottom: "+h.bottom+"px; margin-left: "+h.left+"px; margin-right: "+h.top+"px");o.append("thead").append("tr"),o.append("tbody");var p=n.select("thead").select("tr").selectAll("th").data(function(a){return a.headers});p.enter().append("th");var q=n.select("tbody").selectAll("tr").data(function(a){return a.rows});rowsEnter=q.enter().append("tr"),q.exit().remove();var r=q.selectAll("td").data(function(a){return a});r.enter().append("td"),n.selectAll("th").style("text-align",function(a){return e(a)?"right":"left"}).html(function(a){return a}).on("click",function(b,c){1==k?d3.select(m).call(a.sortBy("")):(c==l(i)?(j=!j,k=!0):k=!1,d3.select(m).call(a.sortBy(b)))}).each(function(a,b){b==l(i)&&(j?d3.select(this).append("span").attr("class","desc"):d3.select(this).append("span").attr("class","asc"))}),n.selectAll("td").style("text-align",function(a){return e(a)?"left":"left"}).text(function(a){if(e(a)){var b=g(a);return b}return a})})}function b(a,d){if(a.length<2)return a;var e=Math.ceil(a.length/2);return c(b(a.slice(0,e),d),b(a.slice(e),d),d)}function c(a,b,c){for(var d=new Array;a.length>0&&b.length>0;)c(a[0],b[0])<=0?d.push(a.shift()):d.push(b.shift());for(;a.length>0;)d.push(a.shift());for(;b.length>0;)d.push(b.shift());return d}function d(a,b){return null===a||null===b?0:("string"==typeof a&&"string"==typeof b&&(a=a.toLowerCase(),b=b.toLowerCase()),j===!0?a>b?-1:a==b?0:1:a>b?1:a==b?0:-1)}function e(a){return!isNaN(parseFloat(a))&&isFinite(a)}var f,g=d3.format(".3f"),h={top:0,bottom:0,left:0,right:0},i="",j=!1,k=!1;return a.margin=function(b){return arguments.length?(h=b,a):h},a.numFormat=function(b){return arguments.length?(g=b,a):g},a.sortBy=function(b){return arguments.length?(i=b,a):i},a.sortDesc=function(b){return arguments.length?(j=b,a):j},a},"function"==typeof window.define&&window.define.amd?window.define("bridle",["jquery","d3"],function(){return a}):window.Bridle=a}();